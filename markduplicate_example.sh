#!/bin/bash
export PATH=/prj/ycc-backup/miniconda3/bin:$PATH
source activate gatk
cd /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4
mkdir -p /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_tmp
/prj/ycc-backup/software/gatk-4.2.5.0/gatk --java-options "-Xmx320G -Xms320G -Djava.io.tmpdir=/prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_tmp/" MarkDuplicatesSpark -I /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_merged_sorted.bam -I /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNW2NDSX5_L1/Z0007_EKDN230004371-1A_HNW2NDSX5_L1_merged_sorted.bam  -M /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_dedup_metrics.txt -O /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sorted_dedup.bam --tmp-dir /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_tmp/ > /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_mrkdup.log 2>&1
picard CollectAlignmentSummaryMetrics -R /prj/ycc-backup/ParusMA/pma.01.03/ref/GCF_001522545.3_Parus_major1.1_genomic.fna -I /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sorted_dedup.bam -O /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_alignment_metrics.txt > /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_colmx.log 2>&1
picard CollectInsertSizeMetrics -INPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sorted_dedup.bam -OUTPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_insert_metrics.txt --Histogram_FILE /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_insert_size_histogram.pdf >> /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_colmx.log 2>&1
source activate samtools
samtools view -b -f 4 /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sorted_dedup.bam > /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sorted_dedup_unmapped.bam
