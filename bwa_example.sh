#!/bin/bash
export PATH=/prj/ycc-backup/miniconda3/bin:$PATH
mkdir -p /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/
cd /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/
source activate gatk
/prj/ycc-backup/software/gatk-4.2.5.0/gatk FastqToSam --FASTQ /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/trim/trim_Z0007_EKDN230004371-1A_HNHMFDSX5_L4_1P.fq.gz --FASTQ2 /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/trim/trim_Z0007_EKDN230004371-1A_HNHMFDSX5_L4_2P.fq.gz --OUTPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/trim_Z0007_EKDN230004371-1A_HNHMFDSX5_L4.fq2sam.bam --READ_GROUP_NAME Z0007_EKDN230004371-1A_HNHMFDSX5_L4 --SAMPLE_NAME Z0007 --LIBRARY_NAME Z0007_EKDN230004371-1A_HNHMFDSX5_L4 --PLATFORM ILLUMINA --PREDICTED_INSERT_SIZE 350 --SORT_ORDER queryname > /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_rg.log 2>&1 
/prj/ycc-backup/software/gatk-4.2.5.0/gatk MarkIlluminaAdapters --INPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/trim_Z0007_EKDN230004371-1A_HNHMFDSX5_L4.fq2sam.bam --OUTPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_nwxt.bam --METRICS /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_nwxt_metrics.txt >> /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_rg.log 2>&1 
/prj/ycc-backup/software/gatk-4.2.5.0/gatk SamToFastq --INPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_nwxt.bam --FASTQ /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sam2fq.fastq --CLIPPING_ATTRIBUTE XT --CLIPPING_ACTION 2 --INTERLEAVE true --INCLUDE_NON_PF_READS true >> /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_rg.log 2>&1 
rm /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_nwxt.bam
/prj/ycc-backup/software/bwa-mem2-2.0pre2_x64-linux/bwa-mem2.sse41 mem -t 1 -p /prj/ycc-backup/ParusMA/pma.01.03/ref/GCF_001522545.3_Parus_major1.1_genomic.fna /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sam2fq.fastq -o /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4.sam > /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_bwa.log 2>&1 
rm /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_sam2fq.fastq
source activate samtools
samtools sort -@ 1 -o /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_alned.bam /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4.sam 
rm /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4.sam
source activate gatk
/prj/ycc-backup/software/gatk-4.2.5.0/gatk MergeBamAlignment --REFERENCE_SEQUENCE /prj/ycc-backup/ParusMA/pma.01.03/ref/GCF_001522545.3_Parus_major1.1_genomic.fna --UNMAPPED_BAM /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/trim_Z0007_EKDN230004371-1A_HNHMFDSX5_L4.fq2sam.bam --ALIGNED_BAM /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_alned.bam --OUTPUT /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_merged.bam --CREATE_INDEX false --ADD_MATE_CIGAR true --CLIP_ADAPTERS false --CLIP_OVERLAPPING_READS true --INCLUDE_SECONDARY_ALIGNMENTS true --MAX_INSERTIONS_OR_DELETIONS -1 --PRIMARY_ALIGNMENT_STRATEGY MostDistant --ATTRIBUTES_TO_RETAIN XS > /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_merge.log 2>&1
rm /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/trim_Z0007_EKDN230004371-1A_HNHMFDSX5_L4.fq2sam.bam /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_alned.bam
source activate samtools
samtools sort -@ 1 -n /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_merged.bam -o /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_merged_sorted.bam
rm /prj/ycc-backup/ParusMA/pma.01.09/ready_reads/Z0007_EKDN230004371-1A_HNHMFDSX5_L4/Z0007_EKDN230004371-1A_HNHMFDSX5_L4_merged.bam
